#!/bin/bash

declare -a elevated_resources=(
    "dynatrace_activegate_token"
    "dynatrace_activegate_updates"
    "dynatrace_alerting"
    "dynatrace_aix_extension"
    "dynatrace_ansible_tower_notification"
    "dynatrace_application_detection_rule_v2"
    "dynatrace_autotag_rules"
    "dynatrace_autotag_v2"
    "dynatrace_api_detection"
    "dynatrace_builtin_process_monitoring"
    "dynatrace_email_notification"
    "dynatrace_jira_notification"
    "dynatrace_audit_log"
    "dynatrace_aws_anomalies"
    "dynatrace_browser_monitor_outage"
    "dynatrace_browser_monitor_performance"
    "dynatrace_business_events_buckets"
    "dynatrace_business_events_metrics"
    "dynatrace_business_events_oneagent"
    "dynatrace_business_events_processing"
    "dynatrace_business_events_security_context"
    "dynatrace_cloud_foundry"
    "dynatrace_cloudapp_workloaddetection"
    "dynatrace_container_builtin_rule"
    "dynatrace_container_registry"
    "dynatrace_container_rule"
    "dynatrace_container_technology"
    "dynatrace_connectivity_alerts"
    "dynatrace_custom_app_anomalies"
    "dynatrace_custom_app_enablement"
    "dynatrace_custom_app_crash_rate"
    "dynatrace_custom_units"
    "dynatrace_dashboards_allowlist"
    "dynatrace_dashboards_general"
    "dynatrace_dashboards_presets"
    "dynatrace_data_privacy"
    "dynatrace_database_anomalies_v2"
    "dynatrace_ddu_pool"
    "dynatrace_declarative_grouping"
    "dynatrace_disk_analytics"
    "dynatrace_disk_anomalies_v2"
    "dynatrace_disk_anomaly_rules"
    "dynatrace_disk_options"
    "dynatrace_disk_specific_anomalies_v2"
    "dynatrace_eula_settings"
    "dynatrace_extension_execution_controller"
    "dynatrace_extension_execution_remote"
    "dynatrace_failure_detection_parameters"
    "dynatrace_failure_detection_rules"
    "dynatrace_frequent_issues"
    "dynatrace_generic_setting"
    "dynatrace_generic_relationships"
    "dynatrace_generic_types"
    "dynatrace_geolocation"
    "dynatrace_host_anomalies_v2"
    "dynatrace_host_monitoring"
    "dynatrace_host_monitoring_mode"
    "dynatrace_host_naming"
    "dynatrace_host_process_group_monitoring"
    "dynatrace_http_monitor_cookies"
    "dynatrace_http_monitor_outage"
    "dynatrace_http_monitor_performance"
    "dynatrace_ibm_mq_filters"
    "dynatrace_ims_bridges"
    "dynatrace_ip_address_masking"
    "dynatrace_issue_tracking"
    "dynatrace_k8s_cluster_anomalies"
    "dynatrace_k8s_monitoring"
    "dynatrace_k8s_namespace_anomalies"
    "dynatrace_k8s_node_anomalies"
    "dynatrace_k8s_pvc_anomalies"
    "dynatrace_k8s_workload_anomalies"
    "dynatrace_key_requests"
    "dynatrace_kubernetes"
    "dynatrace_limit_outbound_connections"
    "dynatrace_log_buckets"
    "dynatrace_log_custom_attribute"
    "dynatrace_log_custom_source"
    "dynatrace_log_events"
    "dynatrace_log_grail"
    "dynatrace_log_metrics"
    "dynatrace_log_oneagent"
    "dynatrace_log_processing"
    "dynatrace_log_security_context"
    "dynatrace_log_sensitive_data_masking"
    "dynatrace_log_storage"
    "dynatrace_log_timestamp"
    "dynatrace_mainframe_transaction_monitoring"
    "dynatrace_maintenance"
    "dynatrace_management_zone_v2"
    "dynatrace_metric_events"
    "dynatrace_metric_metadata"
    "dynatrace_metric_query"
    "dynatrace_mobile_app_anomalies"
    "dynatrace_mobile_app_crash_rate"
    "dynatrace_mobile_app_enablement"
    "dynatrace_mobile_app_key_performance"
    "dynatrace_mobile_app_request_errors"
    "dynatrace_monitored_technologies_apache"
    "dynatrace_monitored_technologies_dotnet"
    "dynatrace_monitored_technologies_go"
    "dynatrace_monitored_technologies_iis"
    "dynatrace_monitored_technologies_java"
    "dynatrace_monitored_technologies_nginx"
    "dynatrace_monitored_technologies_nodejs"
    "dynatrace_monitored_technologies_opentracing"
    "dynatrace_monitored_technologies_php"
    "dynatrace_monitored_technologies_varnish"
    "dynatrace_monitored_technologies_wsmb"
    "dynatrace_muted_requests"
    "dynatrace_nettracer"
    "dynatrace_network_traffic"
    "dynatrace_network_zones"
    "dynatrace_oneagent_default_version"
    "dynatrace_oneagent_features"
    "dynatrace_oneagent_updates"
    "dynatrace_opentelemetry_metrics"
    "dynatrace_ops_genie_notification"
    "dynatrace_os_services"
    "dynatrace_ownership_config"
    "dynatrace_ownership_teams"
    "dynatrace_pager_duty_notification"
    "dynatrace_pg_alerting"
    "dynatrace_process_availability"
    "dynatrace_process_monitoring"
    "dynatrace_process_monitoring_rule"
    "dynatrace_process_visibility"
    "dynatrace_process_group_detection"
    "dynatrace_process_group_detection_flags"
    "dynatrace_process_group_monitoring"
    "dynatrace_process_group_rum"
    "dynatrace_process_group_simple_detection"
    "dynatrace_processgroup_naming"
    "dynatrace_queue_manager"
    "dynatrace_queue_sharing_groups"
    "dynatrace_remote_environments"
    "dynatrace_resource_attributes"
    "dynatrace_rum_advanced_correlation"
    "dynatrace_rum_host_headers"
    "dynatrace_rum_ip_determination"
    "dynatrace_rum_ip_locations"
    "dynatrace_rum_overload_prevention"
    "dynatrace_rum_provider_breakdown"
    "dynatrace_service_anomalies_v2"
    "dynatrace_service_external_web_request"
    "dynatrace_service_external_web_service"
    "dynatrace_service_full_web_request"
    "dynatrace_service_full_web_service"
    "dynatrace_service_failure"
    "dynatrace_service_http_failure"
    "dynatrace_service_now_notification"
    "dynatrace_session_replay_resource_capture"
    "dynatrace_session_replay_web_privacy"
    "dynatrace_slack_notification"
    "dynatrace_slo_normalization"
    "dynatrace_span_attribute"
    "dynatrace_span_capture_rule"
    "dynatrace_span_context_propagation"
    "dynatrace_span_entry_point"
    "dynatrace_span_events"
    "dynatrace_synthetic_availability"
    "dynatrace_synthetic_location"
    "dynatrace_token_settings"
    "dynatrace_transaction_start_filters"
    "dynatrace_trello_notification"
    "dynatrace_unified_services_metrics"
    "dynatrace_unified_services_opentel"
    "dynatrace_update_windows"
    "dynatrace_usability_analytics"
    "dynatrace_user_action_metrics"
    "dynatrace_user_experience_score"
    "dynatrace_user_session_metrics"
    "dynatrace_user_settings"
    "dynatrace_victor_ops_notification"
    "dynatrace_vmware"
    "dynatrace_vmware_anomalies"
    "dynatrace_web_app_anomalies"
    "dynatrace_web_app_beacon_origins"
    "dynatrace_web_app_custom_errors"
    "dynatrace_web_app_enablement"
    "dynatrace_web_app_javascript_updates"
    "dynatrace_web_app_javascript_version"
    "dynatrace_web_app_key_performance_custom"
    "dynatrace_web_app_key_performance_load"
    "dynatrace_web_app_key_performance_xhr"
    "dynatrace_web_app_request_errors"
    "dynatrace_web_app_resource_cleanup"
    "dynatrace_web_app_resource_types"
    "dynatrace_webhook_notification"
    "dynatrace_xmatters_notification"
    "dynatrace_api_token"
    "dynatrace_api_token"
    "dynatrace_attack_alerting"
    "dynatrace_vulnerability_code"
    "dynatrace_vulnerability_settings"
    "dynatrace_vulnerability_third_party"
    "dynatrace_attack_allowlist"
    "dynatrace_attack_rules"
    "dynatrace_attack_settings"
    "dynatrace_vulnerability_alerting"
    "dynatrace_browser_monitor"
    "dynatrace_http_monitor"
    "dynatrace_environment"
    "dynatrace_managed_backup"
    "dynatrace_managed_preferences"
    "dynatrace_managed_public_endpoints"
    "dynatrace_managed_remote_access"
    "dynatrace_managed_smtp"
    "dynatrace_mgmz_permission"
    "dynatrace_policy"
    "dynatrace_policy_bindings"
    "dynatrace_user"
    "dynatrace_user_group"
    "dynatrace_managed_internet_proxy"
    "dynatrace_alerting_profile"
    "dynatrace_application_anomalies"
    "dynatrace_application_data_privacy"
    "dynatrace_application_detection_rule"
    "dynatrace_application_error_rules"
    "dynatrace_autotag"
    "dynatrace_aws_credentials"
    "dynatrace_aws_service"
    "dynatrace_azure_credentials"
    "dynatrace_azure_service"
    "dynatrace_calculated_mobile_metric"
    "dynatrace_calculated_service_metric"
    "dynatrace_calculated_synthetic_metric"
    "dynatrace_calculated_web_metric"
    "dynatrace_cloudfoundry_credentials"
    "dynatrace_custom_anomalies"
    "dynatrace_custom_service"
    "dynatrace_database_anomalies"
    "dynatrace_disk_anomalies"
    "dynatrace_host_anomalies"
    "dynatrace_k8s_credentials"
    "dynatrace_maintenance_window"
    "dynatrace_management_zone"
    "dynatrace_mobile_application"
    "dynatrace_notification"
    "dynatrace_pg_anomalies"
    "dynatrace_request_naming"
    "dynatrace_request_namings"
    "dynatrace_service_anomalies"
    "dynatrace_service_naming"
    "dynatrace_web_application"
    "dynatrace_request_attribute"
    "dynatrace_credentials"
    "dynatrace_dashboard_sharing"
    "dynatrace_network_zone"
    "dynatrace_iam_group"
    "dynatrace_iam_permission"
    "dynatrace_iam_user"
    "dynatrace_iam_policy"
    "dynatrace_iam_policy_bindings"
    "dynatrace_custom_device"
    "dynatrace_custom_tags"
    "dynatrace_automation_business_calendar"
    "dynatrace_automation_scheduling_rule"
    "dynatrace_automation_workflow"
    "dynatrace_platform_bucket"
)

ERROR=false

for val in ${elevated_resources[@]}; do

    if grep -q $val plan.out; then
        echo "ERROR: Terraform plan found a resource of type '$val', this could impact observabilty of the whole program, please remove it from your terraform code."
        ERROR=true
    fi
 
done

if [ "$ERROR" = true ] ; then
    exit 1
fi